name: Wazuh CI/CD - Deploy Local

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  deploy:
    name: Deploy Local e Reiniciar Wazuh
    needs: validate
    # O deploy será executado em um runner self-hosted instalado na mesma máquina do Wazuh Manager.
    runs-on: self-hosted
    steps:
      - name: Fazer checkout do repositório
        uses: actions/checkout@v2

      - name: Copiar Decoders para o Wazuh Manager
        run: |
          echo "Copiando arquivos de Decoders..."
          cp -v Decoders/*.xml /var/ossec/etc/decoders/

      - name: Copiar Regras para o Wazuh Manager
        run: |
          echo "Copiando arquivos de Regras..."
          cp -v Rules/*.xml /var/ossec/etc/rules/

      - name: Reiniciar Wazuh Manager
        run: |
          echo "Reiniciando o serviço do Wazuh Manager..."
          systemctl restart wazuh-manager
